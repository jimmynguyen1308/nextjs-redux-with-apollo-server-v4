import { ApolloServer } from "@apollo/server"
import {
  ApolloServerPluginLandingPageLocalDefault,
  ApolloServerPluginLandingPageProductionDefault,
} from "@apollo/server/plugin/landingPage/default"
import { startServerAndCreateNextHandler } from "@as-integrations/next"

import { typeDefs } from "./typeDefs"
import { resolvers } from "./resolvers"

const apolloServer = new ApolloServer({
  typeDefs,
  resolvers,
  plugins: [
    process.env.NODE_ENV === "production"
      ? ApolloServerPluginLandingPageProductionDefault({
          graphRef: "my-graph-id@my-graph-variant",
          footer: false,
        })
      : ApolloServerPluginLandingPageLocalDefault({ footer: false }),
  ],
})

export default startServerAndCreateNextHandler(apolloServer)
